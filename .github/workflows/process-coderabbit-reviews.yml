name: Process CodeRabbit Reviews

on:
  # Trigger when comments are added to PRs
  issue_comment:
    types: [created]
  # Also trigger on review comments specifically
  pull_request_review_comment:
    types: [created]

jobs:
  analyze-coderabbit-comment:
    # Only run if the comment is from CodeRabbit
    if: |
      contains(github.event.comment.user.login, 'coderabbit') ||
      contains(github.event.comment.user.login, 'rabbit')
    
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
      
      - name: Extract & Process
        env:
          PROMPT: ${{ github.event.comment.body }}
        run: |
          # Extract AI instruction
          echo "$PROMPT" | grep -A1 "Prompt for AI Agents" | grep -v Prompt | sed 's/`//g' > ai_task.txt
          
          if [ -s ai_task.txt ]; then
            echo "Task: $(cat ai_task.txt)"
            # TODO: Send to Claude API here
          fi
